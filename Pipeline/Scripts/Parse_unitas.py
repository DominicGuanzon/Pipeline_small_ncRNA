"""

Parse Unitas outputs to combine all samples into one file.

Steps to do)
Find file name


"""

import glob
import pandas as pd
import os
from functools import reduce

# Find paths for files needing to be parsed.
data_path = "Unitas_annotated_reads/"
Annotation_summary_paths = glob.glob("**/unitas.annotation_summary.txt", recursive=True)
Hit_target_paths = glob.glob("**/unitas.hits_per_target.txt", recursive=True)
TRF_simplified_paths = glob.glob("**/unitas.tRF-table.simplified.txt", recursive=True)
TRF_table_paths = glob.glob("**/unitas.tRF-table.txt", recursive=True)
Full_annoatation_paths = glob.glob("**/unitas.full_annotation_matrix.txt", recursive=True)

data = []

for csv in Annotation_summary_paths:
    frame = pd.read_csv(csv, sep = "\t", names=["RNA_species", "Counts"])
    # This extracts the filename from the folder name generated by Unitas and renames Counts column
    frame = frame.rename(columns = {"Counts": os.path.basename(os.path.dirname(csv).split("_", 2)[2]).rsplit("_", 1)[0]})
    # Find index of genomic_tRNA
    frame.RNA_species[frame.RNA_species.str.contains("genomic_tRNA")].index.tolist()
    # Next extract N  + positions and add prefix to make unique.
    data.append(frame)

df_merged = reduce(lambda  left,right: pd.merge(left,right,on=["RNA_species"], how="outer"), data)
def do_something(data_path, out_path):


